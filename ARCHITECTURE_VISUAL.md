# SkipList Redis 服务器 - 可视化架构图

## 系统整体架构

```
                    ┌─────────────────────────────────────┐
                    │         Client Applications         │
                    │  ┌─────────┐ ┌─────────┐ ┌─────────┐ │
                    │  │Redis CLI│ │Web Apps │ │Mobile   │ │
                    │  └─────────┘ └─────────┘ └─────────┘ │
                    └─────────────────┬─────────────────────┘
                                      │
                                      ▼
                    ┌─────────────────────────────────────┐
                    │           Network Layer             │
                    │  ┌─────────────────────────────────┐ │
                    │  │         TCP Server              │ │
                    │  │  ┌─────────┐ ┌─────────┐        │ │
                    │  │  │Accept   │ │Thread   │        │ │
                    │  │  │Loop     │ │Pool     │        │ │
                    │  │  └─────────┘ └─────────┘        │ │
                    │  │  ┌─────────┐ ┌─────────┐        │ │
                    │  │  │Message  │ │Worker   │        │ │
                    │  │  │Queue    │ │Loop     │        │ │
                    │  │  └─────────┘ └─────────┘        │ │
                    │  └─────────────────────────────────┘ │
                    └─────────────────┬─────────────────────┘
                                      │
                                      ▼
                    ┌─────────────────────────────────────┐
                    │          Business Layer             │
                    │  ┌─────────────┐ ┌─────────────┐   │
                    │  │Redis Handler│ │Redis Protocol│   │
                    │  │             │ │             │   │
                    │  │• Command    │ │• RESP Parser│   │
                    │  │  Execution  │ │• Response   │   │
                    │  │• Data Mgmt  │ │  Generation │   │
                    │  │• AOF Handler│ │• Error Resp │   │
                    │  │• Stats Track│ │• Protocol   │   │
                    │  └─────────────┘ └─────────────┘   │
                    └─────────────────┬─────────────────────┘
                                      │
                                      ▼
                    ┌─────────────────────────────────────┐
                    │           Storage Layer             │
                    │  ┌─────────────┐ ┌─────────────┐   │
                    │  │  SkipList   │ │   AOF       │   │
                    │  │             │ │  System     │   │
                    │  │• 18 Levels  │ │             │   │
                    │  │• O(log n)   │ │• Append Only│   │
                    │  │• Insert/    │ │• Fsync      │   │
                    │  │  Delete     │ │• Recovery   │   │
                    │  │• Search     │ │• Validation │   │
                    │  └─────────────┘ └─────────────┘   │
                    └─────────────────┬─────────────────────┘
                                      │
                                      ▼
                    ┌─────────────────────────────────────┐
                    │         Supporting Layers           │
                    │  ┌─────────┐ ┌─────────┐ ┌─────────┐ │
                    │  │Config   │ │Logger   │ │Utils    │ │
                    │  │Mgmt     │ │System   │ │Library  │ │
                    │  └─────────┘ └─────────┘ └─────────┘ │
                    │  ┌─────────┐ ┌─────────┐ ┌─────────┐ │
                    │  │Replicat │ │Exception│ │Monitor  │ │
                    │  │Manager  │ │Handler  │ │System   │ │
                    │  └─────────┘ └─────────┘ └─────────┘ │
                    └─────────────────────────────────────┘
```

## 数据流向图

```
Client Request Flow:
┌─────────┐    ┌─────────┐    ┌─────────┐    ┌─────────┐    ┌─────────┐
│ Client  │───►│ TCP     │───►│ Thread  │───►│ Redis   │───►│ SkipList│
│ Request │    │ Server  │    │ Pool    │    │ Handler │    │ Storage │
└─────────┘    └─────────┘    └─────────┘    └─────────┘    └─────────┘
      │              │              │              │              │
      ▼              ▼              ▼              ▼              ▼
   RESP Protocol  Connection    Worker Loop   Command Exec   Data Operation
      │              │              │              │              │
      └──────────────┴──────────────┴──────────────┴──────────────┴───► Response
```

## 模块依赖关系

```
                    SkipList Redis Server
                           │
        ┌──────────────────┼──────────────────┐
        │                  │                  │
        ▼                  ▼                  ▼
   ┌─────────┐        ┌─────────┐        ┌─────────┐
   │ Network │        │Business │        │Storage  │
   │ Layer   │        │ Layer   │        │ Layer   │
   └─────────┘        └─────────┘        └─────────┘
        │                  │                  │
        └──────────────────┼──────────────────┘
                           │
        ┌──────────────────┼──────────────────┐
        │                  │                  │
        ▼                  ▼                  ▼
   ┌─────────┐        ┌─────────┐        ┌─────────┐
   │ Config  │        │ Logger  │        │ Utils   │
   │ System  │        │ System  │        │ Library │
   └─────────┘        └─────────┘        └─────────┘
```

## 并发处理架构

```
                    ┌─────────────────────────────────────┐
                    │         Main Thread                 │
                    │  ┌─────────────────────────────────┐ │
                    │  │      Signal Handler             │ │
                    │  │      Stats Monitor              │ │
                    │  │      Configuration              │ │
                    │  └─────────────────────────────────┘ │
                    └─────────────────┬─────────────────────┘
                                      │
                    ┌─────────────────┼─────────────────────┐
                    │                 │                     │
                    ▼                 ▼                     ▼
            ┌─────────────┐   ┌─────────────┐     ┌─────────────┐
            │ Accept      │   │ Worker      │     │ Persistence │
            │ Thread      │   │ Thread Pool │     │ Thread      │
            │             │   │             │     │             │
            │• Connection │   │• Task       │     │• AOF Write  │
            │  Acceptance │   │  Processing │     │• Data Save  │
            │• Client Mgmt│   │• Response   │     │• Recovery   │
            │• Queue Add  │   │  Generation │     │• Validation │
            └─────────────┘   └─────────────┘     └─────────────┘
```

## 存储架构

```
                    ┌─────────────────────────────────────┐
                    │         SkipList Storage            │
                    │  ┌─────────────────────────────────┐ │
                    │  │         Level 0                 │ │
                    │  │  [1] → [3] → [5] → [7] → [9]   │ │
                    │  └─────────────────────────────────┘ │
                    │  ┌─────────────────────────────────┐ │
                    │  │         Level 1                 │ │
                    │  │  [1] → → → → [5] → → → → [9]   │ │
                    │  └─────────────────────────────────┘ │
                    │  ┌─────────────────────────────────┐ │
                    │  │         Level 2                 │ │
                    │  │  [1] → → → → → → → → → → [9]   │ │
                    │  └─────────────────────────────────┘ │
                    │              ...                     │
                    │  ┌─────────────────────────────────┐ │
                    │  │         Level 17                │ │
                    │  │  [1] → → → → → → → → → → [9]   │ │
                    │  └─────────────────────────────────┘ │
                    └─────────────────────────────────────┘
```

## 错误处理架构

```
                    ┌─────────────────────────────────────┐
                    │         Exception Hierarchy         │
                    │  ┌─────────────────────────────────┐ │
                    │  │      std::exception             │ │
                    │  └─────────────────┬───────────────┘ │
                    │                    │                 │
                    │  ┌─────────────────┴───────────────┐ │
                    │  │      SkipListException          │ │
                    │  └─────────────────┬───────────────┘ │
                    │                    │                 │
        ┌───────────┴───────────┬───────┴───────────┬─────┴───────────┐
        │                       │                   │                 │
        ▼                       ▼                   ▼                 ▼
   ┌─────────┐           ┌─────────┐         ┌─────────┐       ┌─────────┐
   │ Config  │           │Network  │         │Storage  │       │Protocol │
   │Exception│           │Exception│         │Exception│       │Exception│
   └─────────┘           └─────────┘         └─────────┘       └─────────┘
        │                       │                   │                 │
        ▼                       ▼                   ▼                 ▼
   ┌─────────┐           ┌─────────┐         ┌─────────┐       ┌─────────┐
   │File Not │           │Socket   │         │File IO  │       │Invalid  │
   │Found    │           │Error    │         │Error    │       │Command  │
   └─────────┘           └─────────┘         └─────────┘       └─────────┘
```

## 部署架构

```
                    ┌─────────────────────────────────────┐
                    │         Production Deployment       │
                    │  ┌─────────────────────────────────┐ │
                    │  │         Load Balancer           │ │
                    │  │  ┌─────────┐ ┌─────────┐        │ │
                    │  │  │ Nginx   │ │ HAProxy │        │ │
                    │  │  └─────────┘ └─────────┘        │ │
                    │  └─────────────────────────────────┘ │
                    └─────────────────┬─────────────────────┘
                                      │
                    ┌─────────────────┼─────────────────────┐
                    │                 │                     │
                    ▼                 ▼                     ▼
            ┌─────────────┐   ┌─────────────┐     ┌─────────────┐
            │ Master      │   │ Slave 1     │     │ Slave N     │
            │ Server      │   │ Server      │     │ Server      │
            │             │   │             │     │             │
            │• Write      │   │• Read       │     │• Read       │
            │  Access     │   │  Access     │     │  Access     │
            │• Data Sync  │   │• Replication│     │• Replication│
            │• Primary    │   │• Backup     │     │• Backup     │
            └─────────────┘   └─────────────┘     └─────────────┘
```

## 性能监控架构

```
                    ┌─────────────────────────────────────┐
                    │         Monitoring System           │
                    │  ┌─────────────────────────────────┐ │
                    │  │         Metrics Collector       │ │
                    │  │  ┌─────────┐ ┌─────────┐        │ │
                    │  │  │Connection│ │Command  │        │ │
                    │  │  │ Count   │ │ Count   │        │ │
                    │  │  └─────────┘ └─────────┘        │ │
                    │  │  ┌─────────┐ ┌─────────┐        │ │
                    │  │  │Uptime   │ │Memory   │        │ │
                    │  │  │         │ │Usage    │        │ │
                    │  │  └─────────┘ └─────────┘        │ │
                    │  └─────────────────────────────────┘ │
                    └─────────────────┬─────────────────────┘
                                      │
                    ┌─────────────────┼─────────────────────┐
                    │                 │                     │
                    ▼                 ▼                     ▼
            ┌─────────────┐   ┌─────────────┐     ┌─────────────┐
            │ Log Files   │   │ Console     │     │ Metrics     │
            │             │   │ Output      │     │ Dashboard   │
            │• Error Logs │   │• Real-time  │     │• Performance│
            │• Access Logs│   │  Stats      │     │  Monitoring │
            │• Debug Logs │   │• Alerts     │     │• Health     │
            │• Rotation   │   │• Status     │     │  Checks     │
            └─────────────┘   └─────────────┘     └─────────────┘
``` 